SUMMARY="Decompilation of 3D Pinball for Windows â€“ Space Cadet"
DESCRIPTION="Reverse engineering of 3D Pinball for Windows - Space Cadet, a game bundled with Windows.
Supports data files from the Windows and Full Tilt versions of the game.

Place the original game resources (not included) in one of these folders:
* ~/config/settings/SpaceCadetPinball
* ~/config/non-packaged/data/SpaceCadetPinball
* /boot/system/non-packaged/data/SpaceCadetPinball/"
HOMEPAGE="https://github.com/k4zmu2a/SpaceCadetPinball"
COPYRIGHT="2020-2023 Andrey Muzychenko, SpaceCadetPinball team"
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://github.com/k4zmu2a/SpaceCadetPinball/archive/refs/tags/Release_$portVersion.tar.gz"
CHECKSUM_SHA256="b647dc59abad3d52378b9f67ff4fb70a37e9752afaff1d098b71028cad29b8d6"
SOURCE_DIR="SpaceCadetPinball-Release_$portVersion"
PATCHES="spacecadetpinball-$portVersion.patchset"
ADDITIONAL_FILES="spacecadetpinball.rdef.in"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	spacecadetpinball$secondaryArchSuffix = $portVersion
	app:SpaceCadetPinball
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	lib:libSDL2_mixer_2.0$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libSDL2$secondaryArchSuffix
	devel:libSDL2_mixer$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	# $cmakeDirArgs does basically nothing atm, recheck on future releases
	cmake -Bbuild -S. -DCMAKE_BUILD_TYPE=Release

	make -C build $jobArgs
}

INSTALL()
{
	# Make install just moves the binary and makes a share folder, so we avoid it
	mkdir -p $appsDir && cp -t $appsDir bin/SpaceCadetPinball

	# Generate the rdef
	local MAJOR="`echo "$portVersion" | cut -b1`"
	local MIDDLE="`echo "$portVersion" | cut -b3`"
	local MINOR="`echo "$portVersion" | cut -b5`"
	local LONG_INFO="$SUMMARY"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		$portDir/additional-files/spacecadetpinball.rdef.in > spacecadetpinball.rdef

	addResourcesToBinaries spacecadetpinball.rdef $appsDir/SpaceCadetPinball
	addAppDeskbarSymlink $appsDir/SpaceCadetPinball "Space Cadet Pinball"
}
